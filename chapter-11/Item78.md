# 对共享可变资源的同步访问

关键字`synchronized`可以确保，同一时刻只有一个线程能够执行方法或代码块。许多程序员认为同步仅仅是互斥的一种方式，当一个对象被一个线程修改时，它可以阻止其它线程看到这个对象的中间态。按照这个观点，对象被创建的时候出于一致的状态（Item 17），当有方法访问它的时候，它就被锁定了。
这些方法观察到对象的状态，并且可能会引起状态转变，即把对象从一种一致的状态转换到另一种不一致的状态。正确地使用同步可以保证没有任何方法会看到对象处于不一致的状态中。

这个观点是正确的，但他只说了一半。没有同步，一个线程的更改可能对其他线程不可见。`synchronization`不仅可以阻止线程看到状态不一致的对象，还可以确保每个进入同步方法或者同步代码块的线程都能看到由相同锁保护的所有以前修改的效果。

`Java`语言规范保证了对变量的读写操作都是原子的（`long`或`double`类型的变量除外） [JLS, 17.4, 17.7]。换句话说，在没有同步的情况下，即使多个线程在并发地修改某个变量，此时读取该变量（`long`或`double`类型的变量除外），也是可以保证返回某个线程存储在该变量中的值的。

你可能听说过，为了提高性能，在读写原子数据时应该避免同步。这个建议是危险的、错误的。虽然语言规范保证线程在读取字段时不会看到不一致的值，但它不能保证一个线程写入的值对另一个线程是可见的。**线程间的可靠通信和互斥都需要同步**。 
这是因为语言规范里有一部分叫作**内存模型**的内容，它描述了一个线程所做的更改何时以及如何对其他线程可见的[JLS, 17.4;Goetz06, 16]。


